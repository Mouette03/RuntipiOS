# Configuration RuntipiOS
# Ce fichier définit les versions et paramètres pour la génération de l'image

# Version de Raspberry Pi OS à utiliser
raspios:
  version: "2024-11-19"  # Format: YYYY-MM-DD (voir https://downloads.raspberrypi.com/raspios_lite_arm64/images/)
  variant: "lite"         # Options: lite, desktop, full
  arch: "arm64"           # Options: arm64, armhf
  url: "https://downloads.raspberrypi.com/raspios_lite_arm64/images/raspios_lite_arm64-2024-11-19/2024-11-19-raspios-bookworm-arm64-lite.img.xz"

# Version de Runtipi
runtipi:
  version: "v3.8.0"       # Version de Runtipi à installer (voir https://github.com/runtipi/runtipi/releases)
  auto_install: true      # Installer automatiquement au premier démarrage
  install_timeout: 1800   # Timeout d'installation en secondes (30 min)
  repo_url: "https://github.com/runtipi/runtipi.git"

# Configuration WiFi-Connect (Balena)
wifi_connect:
  version: "4.4.7"        # Version de wifi-connect (voir https://github.com/balena-os/wifi-connect/releases)
  ssid: "RuntipiOS-Setup" # SSID du point d'accès de configuration
  password: ""            # Laissez vide pour un réseau ouvert
  portal_interface: "wlan0"
  timeout: 1800           # Timeout du portail captif (30 min)
  activity_timeout: 0     # 0 = pas de timeout d'inactivité
  ui_path: "/usr/local/share/wifi-connect/ui"

# Configuration système
system:
  hostname: "runtipios"
  timezone: "Europe/Paris"
  locale: "fr_FR.UTF-8"
  keyboard_layout: "fr"
  
  # Utilisateur par défaut
  default_user: "runtipi"
  default_password: "runtipi"  # CHANGEZ CECI en production !
  
  # SSH
  enable_ssh: true
  ssh_password_auth: true
  ssh_port: 22

# Configuration réseau
network:
  # Si Ethernet est branché, sauter la configuration WiFi
  ethernet_priority: true
  
  # Configuration WiFi de secours (fichier sur boot)
  enable_wifi_fallback: true

# Options de build
build:
  # Taille de l'image (en Go)
  image_size: 8
  
  # Compression de l'image finale
  compress: true
  compression_format: "xz"  # Options: xz, gz, zip
  
  # Hostname de build (pour logs)
  build_hostname: "runtipios-builder"

# Services additionnels
services:
  # Avahi (mDNS) pour résolution .local
  enable_avahi: true
  
  # Docker (requis pour Runtipi)
  docker:
    version: "latest"
    compose_version: "v2.24.5"
  
  # Page de statut web
  status_page:
    enable: true
    port: 8080
    show_runtipi_logo: true

# Sécurité
security:
  # Changer les mots de passe au premier login
  force_password_change: false
  
  # Désactiver l'utilisateur pi par défaut (s'il existe)
  disable_default_user: false
  
  # Configurer le pare-feu
  enable_firewall: false
  
  # Activer les mises à jour automatiques de sécurité
  enable_unattended_upgrades: true

# Packages additionnels à installer
packages:
  install:
    - git
    - curl
    - wget
    - vim
    - nano
    - htop
    - iotop
    - ncdu
    - avahi-daemon
    - avahi-utils
    - network-manager
    - dnsmasq
  
  # Packages à supprimer pour gagner de l'espace
  remove:
    - wolfram-engine
    - libreoffice*

# Métadonnées
metadata:
  project_name: "RuntipiOS"
  project_url: "https://github.com/votre-username/runtipios"
  description: "Système Raspberry Pi OS optimisé pour Runtipi avec configuration WiFi automatique"
  author: "Votre Nom"
  license: "MIT"
